<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RAG çŸ¥è¯†åº“ç®¡ç†</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }
      .section {
        margin-bottom: 30px;
        padding: 20px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
      }
      .section h2 {
        color: #444;
        margin-top: 0;
        margin-bottom: 15px;
      }
      .form-group {
        margin-bottom: 15px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
        color: #555;
      }
      input[type="file"],
      input[type="text"],
      textarea,
      select {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        box-sizing: border-box;
      }
      textarea {
        height: 100px;
        resize: vertical;
      }
      button {
        background-color: #007bff;
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        margin-right: 10px;
      }
      button:hover {
        background-color: #0056b3;
      }
      .result {
        margin-top: 15px;
        padding: 15px;
        border-radius: 4px;
        white-space: pre-wrap;
        max-height: 200px;
        overflow-y: auto;
      }
      .success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .info {
        background-color: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      .loading {
        display: none;
        color: #007bff;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>RAG çŸ¥è¯†åº“ç®¡ç†ç³»ç»Ÿ</h1>

      <!-- æ–‡ä»¶ä¸Šä¼ éƒ¨åˆ† -->
      <div class="section">
        <h2>ğŸ“ æ–‡ä»¶ä¸Šä¼ </h2>
        <form id="fileUploadForm">
          <div class="form-group">
            <label for="fileInput"
              >é€‰æ‹©æ–‡ä»¶ (æ”¯æŒ: .txt, .md, .csv, .json, .py, .js, .html,
              .xml):</label
            >
            <input
              type="file"
              id="fileInput"
              name="file"
              accept=".txt,.md,.csv,.json,.py,.js,.html,.xml"
              required
            />
          </div>
          <div class="form-group">
            <label for="fileDescription">æ–‡ä»¶æè¿° (å¯é€‰):</label>
            <input
              type="text"
              id="fileDescription"
              name="description"
              placeholder="æè¿°è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹..."
            />
          </div>
          <button type="submit">ä¸Šä¼ æ–‡ä»¶</button>
          <span class="loading" id="fileLoading">ä¸Šä¼ ä¸­...</span>
        </form>
        <div id="fileResult" class="result" style="display: none"></div>
      </div>

      <!-- å¤šæ–‡ä»¶ä¸Šä¼ éƒ¨åˆ† -->
      <div class="section">
        <h2>ğŸ“š æ‰¹é‡æ–‡ä»¶ä¸Šä¼ </h2>
        <form id="multiFileUploadForm">
          <div class="form-group">
            <label for="multiFileInput">é€‰æ‹©å¤šä¸ªæ–‡ä»¶:</label>
            <input
              type="file"
              id="multiFileInput"
              name="files"
              multiple
              accept=".txt,.md,.csv,.json,.py,.js,.html,.xml"
              required
            />
          </div>
          <div class="form-group">
            <label for="multiFileDescription">æ‰¹é‡æè¿° (å¯é€‰):</label>
            <input
              type="text"
              id="multiFileDescription"
              name="description"
              placeholder="æè¿°è¿™æ‰¹æ–‡ä»¶çš„å†…å®¹..."
            />
          </div>
          <button type="submit">æ‰¹é‡ä¸Šä¼ </button>
          <span class="loading" id="multiFileLoading">ä¸Šä¼ ä¸­...</span>
        </form>
        <div id="multiFileResult" class="result" style="display: none"></div>
      </div>

      <!-- æ–‡æœ¬å†…å®¹ä¸Šä¼ éƒ¨åˆ† -->
      <div class="section">
        <h2>ğŸ“ æ–‡æœ¬å†…å®¹ä¸Šä¼ </h2>
        <form id="textUploadForm">
          <div class="form-group">
            <label for="textTitle">æ ‡é¢˜ (å¯é€‰):</label>
            <input
              type="text"
              id="textTitle"
              name="title"
              placeholder="ç»™è¿™æ®µæ–‡æœ¬èµ·ä¸ªæ ‡é¢˜..."
            />
          </div>
          <div class="form-group">
            <label for="textDescription">æè¿° (å¯é€‰):</label>
            <input
              type="text"
              id="textDescription"
              name="description"
              placeholder="æè¿°è¿™æ®µæ–‡æœ¬çš„å†…å®¹..."
            />
          </div>
          <div class="form-group">
            <label for="textContent">æ–‡æœ¬å†…å®¹:</label>
            <textarea
              id="textContent"
              name="content"
              placeholder="åœ¨è¿™é‡Œè¾“å…¥è¦æ·»åŠ åˆ°çŸ¥è¯†åº“çš„æ–‡æœ¬å†…å®¹..."
              required
            ></textarea>
          </div>
          <button type="submit">æ·»åŠ æ–‡æœ¬</button>
          <span class="loading" id="textLoading">æ·»åŠ ä¸­...</span>
        </form>
        <div id="textResult" class="result" style="display: none"></div>
      </div>

      <!-- çŸ¥è¯†åº“æŸ¥è¯¢éƒ¨åˆ† -->
      <div class="section">
        <h2>ğŸ” çŸ¥è¯†åº“æŸ¥è¯¢</h2>
        <form id="queryForm">
          <div class="form-group">
            <label for="queryInput">è¾“å…¥é—®é¢˜:</label>
            <input
              type="text"
              id="queryInput"
              name="query"
              placeholder="è¾“å…¥ä½ æƒ³æŸ¥è¯¢çš„é—®é¢˜..."
              required
            />
          </div>
          <div class="form-group">
            <label for="searchMode">æœç´¢æ¨¡å¼:</label>
            <select id="searchMode" name="search_mode">
              <option value="mix">æ··åˆæ¨¡å¼ (æ¨è)</option>
              <option value="local">æœ¬åœ°æœç´¢</option>
              <option value="global">å…¨å±€æœç´¢</option>
              <option value="hybrid">æ··åˆæœç´¢</option>
              <option value="naive">ç®€å•æœç´¢</option>
            </select>
          </div>
          <button type="submit">æŸ¥è¯¢</button>
          <span class="loading" id="queryLoading">æŸ¥è¯¢ä¸­...</span>
        </form>
        <div id="queryResult" class="result" style="display: none"></div>
      </div>

      <!-- ç³»ç»ŸçŠ¶æ€éƒ¨åˆ† -->
      <div class="section">
        <h2>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h2>
        <button onclick="checkHealth()">æ£€æŸ¥ç³»ç»ŸçŠ¶æ€</button>
        <span class="loading" id="healthLoading">æ£€æŸ¥ä¸­...</span>
        <div id="healthResult" class="result" style="display: none"></div>
      </div>
    </div>

    <script>
      // æ–‡ä»¶ä¸Šä¼ 
      document
        .getElementById("fileUploadForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const loading = document.getElementById("fileLoading");
          const result = document.getElementById("fileResult");

          loading.style.display = "inline";
          result.style.display = "none";

          try {
            const formData = new FormData(e.target);
            const response = await fetch("/upload-file", {
              method: "POST",
              body: formData,
            });

            const data = await response.json();

            result.textContent = JSON.stringify(data, null, 2);
            result.className = response.ok ? "result success" : "result error";
            result.style.display = "block";

            if (response.ok) {
              e.target.reset();
            }
          } catch (error) {
            result.textContent = `é”™è¯¯: ${error.message}`;
            result.className = "result error";
            result.style.display = "block";
          }

          loading.style.display = "none";
        });

      // å¤šæ–‡ä»¶ä¸Šä¼ 
      document
        .getElementById("multiFileUploadForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const loading = document.getElementById("multiFileLoading");
          const result = document.getElementById("multiFileResult");

          loading.style.display = "inline";
          result.style.display = "none";

          try {
            const formData = new FormData(e.target);
            const response = await fetch("/upload-multiple-files", {
              method: "POST",
              body: formData,
            });

            const data = await response.json();

            result.textContent = JSON.stringify(data, null, 2);
            result.className = response.ok ? "result success" : "result error";
            result.style.display = "block";

            if (response.ok) {
              e.target.reset();
            }
          } catch (error) {
            result.textContent = `é”™è¯¯: ${error.message}`;
            result.className = "result error";
            result.style.display = "block";
          }

          loading.style.display = "none";
        });

      // æ–‡æœ¬ä¸Šä¼ 
      document
        .getElementById("textUploadForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const loading = document.getElementById("textLoading");
          const result = document.getElementById("textResult");

          loading.style.display = "inline";
          result.style.display = "none";

          try {
            const formData = new FormData(e.target);
            const response = await fetch("/upload-text", {
              method: "POST",
              body: formData,
            });

            const data = await response.json();

            result.textContent = JSON.stringify(data, null, 2);
            result.className = response.ok ? "result success" : "result error";
            result.style.display = "block";

            if (response.ok) {
              e.target.reset();
            }
          } catch (error) {
            result.textContent = `é”™è¯¯: ${error.message}`;
            result.className = "result error";
            result.style.display = "block";
          }

          loading.style.display = "none";
        });

      // çŸ¥è¯†åº“æŸ¥è¯¢
      document
        .getElementById("queryForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const loading = document.getElementById("queryLoading");
          const result = document.getElementById("queryResult");

          loading.style.display = "inline";
          result.style.display = "none";

          try {
            const formData = new FormData(e.target);
            const response = await fetch("/query", {
              method: "POST",
              body: formData,
            });

            const data = await response.json();

            result.textContent = JSON.stringify(data, null, 2);
            result.className = response.ok ? "result success" : "result error";
            result.style.display = "block";
          } catch (error) {
            result.textContent = `é”™è¯¯: ${error.message}`;
            result.className = "result error";
            result.style.display = "block";
          }

          loading.style.display = "none";
        });

      // ç³»ç»Ÿå¥åº·æ£€æŸ¥
      async function checkHealth() {
        const loading = document.getElementById("healthLoading");
        const result = document.getElementById("healthResult");

        loading.style.display = "inline";
        result.style.display = "none";

        try {
          const response = await fetch("/health");
          const data = await response.json();

          result.textContent = JSON.stringify(data, null, 2);
          result.className = response.ok ? "result info" : "result error";
          result.style.display = "block";
        } catch (error) {
          result.textContent = `é”™è¯¯: ${error.message}`;
          result.className = "result error";
          result.style.display = "block";
        }

        loading.style.display = "none";
      }

      // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
      window.addEventListener("load", checkHealth);
    </script>
  </body>
</html>
